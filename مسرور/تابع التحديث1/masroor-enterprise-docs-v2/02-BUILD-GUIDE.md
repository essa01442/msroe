# دليل البناء والتشغيل — نسخة مؤسسية

## 1) المتطلبات
- خادم محلي ثابت IP.
- PostgreSQL 16 + امتداد pgvector.
- DuckDB للقراءة التحليلية من الباردة.
- Masroor-Orchestrator + Memory Agent + Telegram Gateway.

## 2) إعداد البيانات
- إنشاء قواعد بيانات: masroor_core, agents_store.
- جداول: conversations, messages, agent_index, masroor_index_of_indexes, billing_usage.
- ضبط الفهارس: نصية (FTS) + دلالية (pgvector).

## 3) تشغيل الخدمات
- تشغيل Postgres ثم Memory Agent ثم Orchestrator وأخيرًا Telegram Gateway.
- اختبار استعلام سريع للفهارس في الساخنة والدافئة.

## 4) سياسة الذاكرة
- ساخنة: 30k. دافئة: 70k. باردة: غير محدودة.
- ترحيل تلقائي حسب الأهمية والتقادم.
- Manifest للباردة مع checksums.

## 5) التكامل
- بروتوكول JSON موحد، طوابع ISO، حقول ثقة.
- مسار ثابت لتمرير الملخصات ثم تفاصيل عند الطلب.

## 6) التكلفة
- سقف 5$ شهريًا لكل وكيل.
- عند 80% يتم التبديل إلى وضع الملخصات وإشعار التقارير والتنفيذي.

## 7) الاختبارات
- وحدات وتكامل وأمان وأداء.
- قبول المهمة مشروط بالـ KPIs المحددة لكل وكيل.

## 8) الصيانة
- Vacuum/Analyze دوري لقاعدة البيانات.
- تحديثات ربع سنوية للأوركستراتور والشخصيات.

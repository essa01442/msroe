# التشغيل ودلائل المهام (Runbooks & Playbooks)

مرجع عملي مُحدث للتشغيل اليومي، إدارة الحوادث، والتعافي من الكوارث.

## 1) نظرة عامة
- الأهداف: استقرار، أداء، أمان، امتثال.
- مؤشرات الحماية: SLOs متّفق عليها، ميزانيات الأخطاء، تنبيهات حرجة.

## 2) مهام دورية
- يوميًا:
  - مراجعة تنبيهات الليلة السابقة.
  - التحقق من صحة Jobs المُجدولة ونتائج النسخ الاحتياطي.
- أسبوعيًا:
  - مراجعة تغييرات التهيئة مقارنة بالمرجعي.
  - اختبار عينات سجلات الوصول ومراجعتها.
- شهريًا:
  - اختبار استعادة من نسخة حقيقية (Tabletop + تنفيذية).
  - تدقيق صلاحيات الوصول والدوران الدوري للأسرار.
- ربع سنوي:
  - اختبار فشل تبعية رئيسية (GameDay).
  - مراجعة سعة الموارد واتجاهات الاستهلاك.

## 3) إجراءات تشغيل قياسية (SOP)
- نشر إصدار جديد:
  1. فحص الحالة الصحية (pre-checks).
  2. نشر تدريجي Canary بنسبة 5% → 25% → 100%.
  3. مراقبة KPIs وSLIs لمدّة X دقائق بين المراحل.
  4. نجاح: تعميم الإصدار وتحديث العلامة. فشل: تراجع آلي فوري.
- تغييرات التهيئة:
  - قاعدة: جميع التهيئات مُدارة ككود مع مراجعة أقران.
  - قبل الدمج: اختبارات تكامل + محاكاة أثر على الأداء.
- إيقاف/تشغيل مكوّن:
  - المتطلبات المسبقة: تصريف الحمل، إتمام المعاملات، تنبيه الفرق المعنية.

## 4) التعامل مع الحوادث (Incidents)
- تصنيف الشدة:
  - SEV-1: انقطاع خدمة أساسي أو تسريب أمان نشط.
  - SEV-2: تدهور كبير يؤثر >20% من المستخدمين.
  - SEV-3: أثر متوسط أو تدهور محدود.
- خط الاستجابة:
  1. إعلان الحادث وتعيين قائد الحادث (IC) وكاتب الوقائع.
  2. Triage: تحديد النطاق، فرض Freeze تغييرات.
  3. احتواء: Circuit Breakers، تقليل ميزات، توسيع موارد.
  4. استعادة الخدمة: إصلاحات مع متابعة SLO.
  5. إغلاق: تأكيد استقرار ≥ 30–60 دقيقة.
  6. ما بعد الحادث: تقرير RCA بلا لوم خلال 48 ساعة مع بنود عمل قابلة للقياس.
- الاتصال:
  - قنوات: Slack #incidents، بريد incident@…
  - رسائل جاهزة للعملاء/القيادة مع تحديثات كل 30 دقيقة لـ SEV-1.
- التصعيد:
  - مصفوفة: IC → قائد SRE → أمن/قانوني → قيادة.
  - معايير: مدة التجاوز عن SLO، أثر الإيراد/الأمن.

## 5) المراقبة والتنبيهات
- SLIs: زمن استجابة P95، معدل أخطاء 5xx، نسبة نجاح الطلبات.
- عتبات:
  - P95 > 500ms لمدة 5 دقائق → SEV-2.
  - معدل أخطاء > 2% لمدة 10 دقائق → SEV-2.
- ضوضاء التنبيه:
  - سياسات دمج وتخميل، ومراجعة شهرية لـ Alert Fatigue.

## 6) خطط الطوارئ والتعافي (DR/BCP)
- أهداف: RPO ≤ 15 دقيقة، RTO ≤ 60 دقيقة.
- النسخ الاحتياطي: Snapshots مشفّرة متعددة الأقاليم، تحقّق دوري.
- الاستعادة:
  1. اختيار نقطة الاستعادة.
  2. تهيئة بيئة نظيفة.
  3. استعادة البيانات والتحقق.
  4. إعادة توجيه الحركة.
  5. تحقق ما بعد الاستعادة + توقيع المالك.
- اختبارات: شهرية (مُؤتمتة) وربع سنوية (شاملة).

## 7) الأمان والامتثال
- إدارة الأسرار: مخزن مركزي + دوران كل 90 يومًا.
- التحكم بالوصول: أقل صلاحية، مراجعة دورية للـ RBAC.
- تتبع: سجلات مُحصّنة، تتبّع موزع، احتفاظ وفق السياسة.

## 8) الجاهزية التشغيلية
- شروط Go/No-Go للنشر.
- لوحات قيادة: صحة التبعيات، مؤشرات SLO، استخدام الموارد.

## 9) المراجع
- سجل المخاطر: R-00X.
- ADRs: ADR-001، ADR-002.